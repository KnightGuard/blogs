# Windows

## 0x00 文件目录操作

### 1.查找文件

cmd:

```cmd
for /r 目录名 %变量名 in (匹配模式1,匹配模式2) do 命令
for /r d: %i in (*) do @echo %i
for /r d: %i in (*.txt,*.jpg) do @echo %i
for /r d: %i in (*shell.jsp) do @echo %i
```

### 2.查看文件内容

cmd:

```cmd
type "D:\www\shell.jsp"
```

powershell:

```powershell
Get-Content "D:\www\shell.jsp"
```

### 3.删除文件

cmd:

```cmd
#删文件
del index.js
#删文件夹
rd app
```

powershell:

```powershell
remove-item w.ps1 -Force -Recurse
```

### 4.查看目录

cmd:

```cmd
#下载目录
dir C:\Users\%username%\Downloads
#桌面
dir C:\Users\%username%\Desktop
#微信
dir C:\Users\%username%\Documents\WeChat Files\wx*\FileStorage\File\
#磁盘盘符数
powershell -Command "[Environment]::GetLogicalDrives()"
```



## 0x01 注册表

### 1.常见注册表项

```cmd
#启动项
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
#账户
HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names
REG QUERY HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa
REG QUERY HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa /v LimitBlankPasswordUse
#网口配置文件
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
#隐藏文件置0
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\Hidden\SHOWALL
#网络连接历史
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged
```
### 2.查看 

cmd:

```cmd
REG QUERY HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa
REG QUERY HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa /v LimitBlankPasswordUse
```
powershell:

```powershell
$key=Get-ItemProperty -Path "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion"
$key``.CommonFilesDir
```

### 3.添加

```cmd
reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v "Keyname" /t REG_SZ /d "C:\Users\Administrator\Desktop\shell.exe" /f 
```

### 4.导出

```cmd
reg export HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa AppBkUp.reg
```

## 0x02 密码收集

### 1 企业域内账号凭据

1> C:/User/账户名/pip/pip.ini

pip.ini 内网中可能还有http代理信息，代理信息中可能含有账户名及密码。

2>

### 2 无线密码

```powershell
#执行下面命令，密码导出在生成的xml文件中
netsh WLAN export profile key=clear folder=.
```

### 3 mobaxterm

对于安装版的moba，可以通过读取注册表，得到明文密码。
reg query HKEY_CURRENT_USER\Software\Mobatek\MobaXterm
reg query HKEY_CURRENT_USER\Software\Mobatek\MobaXterm\P
更多：https://www.cnblogs.com/yang34/p/14236230.html

### 4 XShell

https://github.com/dzxs/Xdecrypt

### 5 浏览器

提供以下两种方法：

**5.1 工具**：

https://github.com/AlessandroZ/LaZagne/releases

**5.2 可操作桌面时**：

火狐->打开菜单->我的密码

Chrome->设置->自动填充->密码

### 6 数据库密码

本地web目录下找配置目录中的配置文件



### [x] to be continue

filezilla/teamviewer/vnc/系统哈希/navicat

## 0x03 敏感数据发现

### 1 回收站分析

```powershell
FOR /f "skip=1 tokens=1,2 delims= " %c in ('wmic useraccount get name,sid') do dir /a /b C:\$Recycle.Bin\%d\ >%c.txt
PowerShell -Command  "$Recycler =(New-Object -ComObject Shell.Application).NameSpace(0xa);foreach($file in $Recycler.items()){echo "---------------------";$file.path;$file.ExtendedProperty(\"{9B174B33-40FF-11D2-A27E-00C04FC30871} 2\")+'\'+$file.name}"
```

### 2 常见目录

```shell
# 桌面
C:\Users\%username%\Desktop
# 下载目录
C:\Users\%username%\Downloads
# 微信下载目录
C:\Users\%username%\Documents\WeChat Files\微信号\FileStorage\File\归档日期
```

### 3 VMware

```shell
#一些传送的文件
C:\Users\%username%\AppData\Local\Temp\vmware-%username%\VMwareDnD
#每台vmware的log日志都含有启动操作信息。
C:\Users\%username%\AppData\Local\Temp\vmware-%username%\
#vmware内主机的备注信息
```

## 0x04 历史记录

### 1 Git-Bash历史记录:

```cmd
C:\Users\%username%\.bash_history
C:\Users\%username%\.gitconfig
```

### 2 运行框历史记录

```shell
reg query HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
reg query HKEY_USERS\<sid>\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
```

### 3 powershell历史记录

```shell
Get-Content (Get-PSReadLineOption).HistorySavePath
```

### 4 DNS缓存记录

```cmd
ipconfig /displaydns
```



# Linux

## 0x00 历史记录

```shell
# /root/ 及 /home/*/
.bash_history
.zsh_history
.mysql_history
```

## 0x01 各类凭据

```shell
# web服务类
# -- 定位到服务目录下的配置目录。查看配置文件中的数据库口令

# 登录用户
# 结合 history|grep ssh 及~/.ssh/authorized_keys拿到其他设备的登录权限。

# redis 
# -- 定位配置文件中的requirepass
find / -name redis.conf

# 密码搜集
grep -rn "pass" -a / | grep -v "php\|jsp\|\.js\|\|.java"
find / -name *.properties -o -name *.xml -o -name *.conf -o -name *.json -exec grep -Hn "passw" {} \;
```



# SQL

```mysql
/*MySQL数据库内找密码*/
SELECT TABLE_NAME FROM `information_schema`.`COLUMNS` where `COLUMN_NAME` like '%pass%';
SELECT TABLE_NAME FROM `information_schema`.`COLUMNS` where `COLUMN_NAME` like '%pwd%';
```

